# 项目文档

> **📋 最新更新**: 2025年12月10日 - 完成全栈结构优化与样式分离

## 1. 项目简介
本项目是一个基于 **React + Vite** 前端和 **Spring Boot 3.5.7** 后端的全栈博客与社交平台。项目采用前后端分离架构，通过 Docker 容器化部署，并使用 Nginx 进行反向代理和静态资源服务。

## 2. 技术栈

### 前端
- **框架**: React 18.3.1
- **构建工具**: Vite 7.1.7
- **语言**: JavaScript (ES Modules)
- **样式**: CSS Modules (按功能模块分类)
- **编辑器**: Tiptap (富文本编辑)
- **路由**: React Router DOM 7.9.5
- **状态管理**: Context API + Hooks
- **HTTP客户端**: Axios 1.13.1

### 后端
- **框架**: Spring Boot 3.5.7
- **语言**: Java 17+
- **构建工具**: Maven
- **数据库**: MySQL
- **ORM**: JPA/Hibernate
- **安全**: Spring Security + JWT
- **实时通信**: SSE (Server-Sent Events)
- **AI集成**: Spring AI
- **其他**: MapStruct, Redis, RabbitMQ

### 部署
- **容器化**: Docker + Docker Compose
- **网关/代理**: Nginx

## 3. 功能模块

### 3.1 用户系统
- **注册/登录**: 支持 JWT 认证，支持本地/QQ/微信/手机号登录。
- **个人资料**: 用户可以修改昵称、简介、性别等。
- **头像/背景**: 支持上传自定义头像和个人主页背景图（由 Nginx 直接服务）。
- **安全**: 密码加密存储，Token 鉴权。

### 3.2 博客系统
- **文章发布**: 集成 Tiptap 编辑器，支持富文本、图片上传、Markdown解析。
- **文章浏览**: 首页列表、详情页、分类浏览、标签系统。
- **互动**: 点赞、收藏、分享、转发。
- **评论**: 支持文章评论及多级回复。
- **统计**: 浏览量、点赞数、评论数等统计。

### 3.3 社交系统
- **关注**: 用户之间可以相互关注，查看粉丝/关注列表。
- **好友**: 发送好友请求，接受/拒绝好友，好友列表管理。
- **私信**: 实时聊天功能，支持发送文本、图片、视频、文件（SSE 实现消息推送）。
- **通知**: 统一的通知中心，处理好友请求、系统通知等。
- **拉黑**: 支持拉黑用户。

### 3.4 AI 助手
- **集成**: 内置 AI 助手上下文 (`AiAssistantContext`)，支持智能对话辅助。

## 4. 架构优化与规范

### 4.1 前端结构
- `src/pages`: 存放所有页面组件。
- `src/components`: 存放可复用组件，按功能模块划分为 `common`, `user`, `article`, `home`, `layout` 等。
- `src/styles`: 样式文件集中管理，与逻辑代码分离。
- `src/utils`: 工具函数。
- `src/hooks`: 自定义 Hooks。

### 4.2 后端结构
- 遵循 Spring Boot 分层架构：
    - `Controller`: 处理 HTTP 请求，参数校验。
    - `Service`: 业务逻辑处理。
    - `Repository`: 数据访问层。
    - `Model/DTO`: 数据模型与传输对象。
- **静态资源优化**: 用户上传的图片（头像、文章配图、聊天图片）由后端存储到指定目录，读取时由 Nginx 直接映射目录提供服务，不再经过 Tomcat，大幅提升加载速度。

## 5. 数据库模型

### 核心实体

#### 1. User (用户表)
```sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(15) UNIQUE NOT NULL,    -- 用户名 (5-15字符)
    password VARCHAR(150),                   -- 密码 (BCrypt加密)
    gender VARCHAR(2),                       -- 性别
    phone_number VARCHAR(20),                -- 手机号码
    qq_open_id VARCHAR(50) UNIQUE,           -- QQ OpenID
    wechat_union_id VARCHAR(50) UNIQUE,      -- 微信 UnionID
    login_provider VARCHAR(20)               -- 登录方式
);
```

#### 2. UserProfile (用户资料表)
```sql
CREATE TABLE user_profile (
    user_id BIGINT PRIMARY KEY,              -- 与User表一对一关联
    nickname VARCHAR(255),                   -- 昵称
    avatar_url VARCHAR(500),                 -- 头像URL
    background_url VARCHAR(500),             -- 背景图URL
    gender VARCHAR(2),                       -- 性别
    FOREIGN KEY (user_id) REFERENCES user(id)
);
```

#### 3. BlogPost (博客文章表)
```sql
CREATE TABLE blog_post (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255),                      -- 标题
    user_id BIGINT NOT NULL,                 -- 作者ID
    cover_image_url VARCHAR(500),            -- 封面图URL
    content TEXT NOT NULL,                   -- 正文内容
    directory TEXT,                          -- 目录/大纲
    like_count BIGINT DEFAULT 0,             -- 点赞数
    comment_count BIGINT DEFAULT 0,          -- 评论数
    share_count BIGINT DEFAULT 0,            -- 分享数
    favorite_count BIGINT DEFAULT 0,         -- 收藏数
    repost_count INT DEFAULT 0,              -- 转发数
    is_repost BOOLEAN DEFAULT FALSE,         -- 是否为转发
    original_post_id BIGINT,                 -- 原文章ID
    category_id BIGINT,                      -- 分类ID
    created_at TIMESTAMP NOT NULL,           -- 创建时间
    updated_at TIMESTAMP,                    -- 更新时间
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (original_post_id) REFERENCES blog_post(id),
    FOREIGN KEY (category_id) REFERENCES category(id)
);
```

*(更多表结构如 Category, Tag, Comment, Follow, FriendRequest, PrivateMessage 等详见数据库设计文档)*

## 6. API接口概览

### 基础URL
- 开发环境: `http://localhost:8080/api`
- 认证方式: Header `Authorization: Bearer <token>`

### 主要模块

#### 用户模块 (/api/user)
- `POST /register`: 注册
- `POST /login`: 登录
- `GET /profile/{userId}`: 获取资料
- `PUT /profile/{userId}`: 更新资料
- `POST /profile/{userId}/avatar`: 上传头像
- `POST /profile/{userId}/background`: 上传背景

#### 文章模块 (/api/blogpost)
- `POST /`: 创建文章
- `GET /{id}`: 获取详情
- `GET /`: 获取列表 (分页)
- `POST /{id}/like`: 点赞
- `PUT /{id}`: 更新文章
- `DELETE /{id}`: 删除文章
- `POST /media`: 上传文章图片

#### 社交模块
- `POST /api/follow/{targetId}`: 关注
- `POST /api/friends/request/{targetId}`: 发送好友请求
- `POST /api/messages/text/{otherId}`: 发送私信
- `GET /api/messages/conversation/{otherId}`: 获取对话记录

*(完整API文档请参考 Swagger 或 API 详细文档)*

## 7. 部署与运维

### 7.1 构建
项目使用 `docker-compose` 进行编排。
```bash
# 构建并启动
docker-compose up -d --build
```

### 7.2 清理
在更新部署后，建议清理旧的 Docker 镜像和容器以释放空间：
```bash
docker system prune -f
```

## 8. 未来规划
- **性能优化**: 引入 Redis 缓存热点数据（如文章列表、用户信息）。
- **搜索增强**: 集成 Elasticsearch 提供全文检索。
- **移动端适配**: 进一步优化响应式布局。
- **CI/CD**: 搭建自动化部署流水线。
