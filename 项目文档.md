# PenRoseBlog - 个人博客系统

> **📋 最新更新**: 2025年12月12日 - 全栈架构优化与AI助手集成

## 项目概述

PenRoseBlog 是一个功能完善的现代化全栈个人博客系统。它不仅具备传统的博客功能（文章发布、评论、分类），还深度集成了 AI 助手、实时消息推送、Live2D 看板娘等前沿特性。项目采用前后端分离架构，容器化部署，具备高可用性和良好的扩展性。

### 核心技术栈

**后端 (Backend)**
- **Framework**: Spring Boot 3.5.7
- **Language**: Java 17
- **Database**: MySQL 8.0 (JPA/Hibernate)
- **Cache**: Redis (缓存、防刷计数、验证码)
- **Message Queue**: RabbitMQ (异步解耦、削峰填谷)
- **Security**: Spring Security + JWT (无状态认证)
- **AI Integration**: Spring AI (对接大模型服务)
- **Tools**: Flyway (数据库迁移), MapStruct (DTO映射), Lombok

**前端 (Frontend)**
- **Framework**: React 18.3.1
- **Build Tool**: Vite 7.1.7
- **Routing**: React Router DOM 7.9.5
- **State Management**: React Context + Hooks
- **UI/UX**: CSS Modules, Responsive Design (响应式适配)
- **Editor**: TipTap (富文本), Marked (Markdown渲染)
- **Interaction**: Live2D (看板娘), SSE (实时消息流)

**运维 (DevOps)**
- **Container**: Docker, Docker Compose
- **Server**: Nginx (反向代理, 静态资源托管)
- **CI/CD**: Shell Scripts (自动化部署)

## 系统架构

### 1. 分层架构设计
后端严格遵循分层架构原则，确保代码的可维护性与测试性：
- **Controller Layer**: 处理 HTTP 请求，参数校验 (`@Valid`)，统一响应封装 (`ApiResponse`)。
- **Service Layer**: 核心业务逻辑，事务管理 (`@Transactional`)。
- **Repository Layer**: 数据持久化，基于 Spring Data JPA。
- **Model/DTO**: 实体类与数据传输对象分离，通过 MapStruct 自动转换，避免数据库模型直接暴露。

### 2. 核心功能模块

#### 🤖 AI 助手 (AI Assistant)
- **智能对话**: 集成 Spring AI，支持与大模型进行实时对话。
- **流式响应**: 前端通过 SSE (`EventSource`) 接收 AI 的流式回复，体验流畅。
- **多模态支持**: 支持发送文本及附件（图片/文件）给 AI 进行分析。

#### 📊 混合式浏览量统计 (Hybrid View Counting)
- **高并发设计**: 浏览请求优先写入 Redis，原子计数 (`INCR`)。
- **防刷机制**: 使用 Redis Set 记录 24 小时内访问过的用户/IP，避免重复计数。
- **数据同步**: 定时任务 (`@Scheduled`) 异步将 Redis 中的增量数据同步回 MySQL，保证数据最终一致性。

#### 🔔 实时消息通知 (Real-time Notifications)
- **多渠道推送**: 支持站内信、点赞、评论、关注等多种通知类型。
- **异步处理**: 耗时操作（如邮件发送）通过 RabbitMQ 异步处理，不阻塞主线程。
- **实时触达**: 客户端通过 SSE 保持长连接，实时接收新消息提醒。

#### 📝 内容创作与管理
- **双模式编辑器**: 支持 Markdown 和富文本 (TipTap) 两种编辑模式。
- **资源管理**: 统一的文件上传接口，支持头像、背景图、文章插图的上传与管理。
- **分类与标签**: 灵活的文章分类与标签系统，支持多维度检索。

#### 👤 用户与社交
- **安全认证**: 基于 JWT 的无状态认证，支持 Token 自动刷新。
- **社交互动**: 关注、粉丝、好友申请、私信聊天。
- **个性化**: 自定义头像、个人主页背景、个人简介。

## 部署与运维

### 自动化部署
项目包含完整的自动化部署脚本 (`redeploy.sh`)，支持：
- 一键拉取最新代码
- 自动构建 Docker 镜像
- 平滑重启服务
- 自动清理旧镜像

### 环境配置
- **开发环境**: `application.properties` (本地调试)
- **生产环境**: `application-prod.properties` (Docker部署，通过环境变量注入敏感信息)
- **安全配置**: 敏感密钥（如 DB 密码、JWT Secret）均通过环境变量管理，不硬编码在代码中。

## 目录结构说明

```
PenRoseBlog/
├── backend/                 # Spring Boot 后端
│   ├── src/main/java/com/kirisamemarisa/blog/
│   │   ├── ai/             # AI 模块
│   │   ├── config/         # 全局配置 (Security, Web, Redis...)
│   │   ├── controller/     # 控制器
│   │   ├── service/        # 业务逻辑
│   │   └── ...
│   └── Dockerfile          # 后端镜像构建文件
├── front/                   # React 前端
│   ├── src/
│   │   ├── components/     # UI 组件
│   │   ├── contexts/       # 全局状态 (Auth, AI...)
│   │   ├── pages/          # 页面视图
│   │   └── utils/          # 工具函数 (API封装, URL解析...)
│   ├── nginx.conf          # Nginx 配置
│   └── Dockerfile          # 前端镜像构建文件
├── docker-compose.yml       # 容器编排文件
├── redeploy.sh              # 自动化部署脚本
└── DEPLOY_GUIDE_NEW.md      # 详细部署指南
```
